---
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';
import avatar from '../assets/logos/diz-rocks-avatar.svg';
import { SOCIAL_LINKS } from '../consts';
import HeaderLink from './HeaderLink.astro';
import ThemeToggle from './ThemeToggle.astro';

const navItems = [
  { href: '/', label: 'Home', icon: 'tabler:home' },
  { href: '/blog', label: 'Blog', icon: 'tabler:news' },
  { href: '/cv', label: 'CV', icon: 'tabler:user-code' },
];

const aboutItems = [
  { href: '/about', label: 'About', icon: 'tabler:user' },
  { href: '/uses', label: 'Uses', icon: 'tabler:tool' },
  { href: '/now', label: 'Now', icon: 'tabler:clock-hour-4' },
];
---

<header class="navbar bg-base-100 shadow-sm sticky top-0 z-50">
  <div class="navbar-start">
    <div class="dropdown">
      <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
        <Icon name="tabler:menu-2" class="h-5 w-5" />
      </div>
      <ul
        tabindex="0"
        class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52"
      >
        {
          navItems.map((item) => (
            <li>
              <HeaderLink href={item.href} icon={item.icon}>
                {item.label}
              </HeaderLink>
            </li>
          ))
        }
        <li class="dropdown">
          <div tabindex="0" role="button" class="flex items-center gap-2">
            <Icon name="tabler:user" class="h-4 w-4" />
            About
            <Icon name="tabler:chevron-down" class="h-3 w-3" />
          </div>
          <ul tabindex="-1" class="dropdown-content menu bg-base-100 rounded-box shadow-lg p-2 min-w-32 z-[2]">
            {
              aboutItems.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class="flex items-center gap-2"
                    onclick="document.activeElement?.blur()"
                  >
                    <Icon name={item.icon} class="h-4 w-4" />
                    {item.label}
                  </a>
                </li>
              ))
            }
          </ul>
        </li>
      </ul>
    </div>
    <a href="/" class="btn btn-ghost text-xl gap-2">
      <Image src={avatar} alt="" class="w-8 h-8" />
      Rock Out
    </a>
  </div>

  <div class="navbar-center hidden lg:flex">
    <ul class="menu menu-horizontal gap-2">
      {
        navItems.map((item) => (
          <li>
            <HeaderLink href={item.href} icon={item.icon}>
              {item.label}
            </HeaderLink>
          </li>
        ))
      }
      <li class="dropdown dropdown-end">
        <div tabindex="0" role="button" class="flex items-center gap-2 cursor-pointer">
          <Icon name="tabler:user" class="h-4 w-4" />
          About
          <Icon name="tabler:chevron-down" class="h-3 w-3" />
        </div>
        <ul tabindex="-1" class="dropdown-content menu bg-base-100 rounded-box shadow-lg p-2 min-w-32 z-[1]">
          {
            aboutItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class="flex items-center gap-2"
                  onclick="document.activeElement?.blur()"
                >
                  <Icon name={item.icon} class="h-4 w-4" />
                  {item.label}
                </a>
              </li>
            ))
          }
        </ul>
      </li>
    </ul>
  </div>

  <div class="navbar-end gap-2">
    <ThemeToggle />
    <a
      href={`${SOCIAL_LINKS.github}/hq`}
      target="_blank"
      rel="noopener noreferrer"
      class="btn btn-ghost btn-circle"
      aria-label="GitHub"
    >
      <Icon name="tabler:brand-github" class="w-5 h-5" aria-hidden="true" />
    </a>
  </div>
</header>

<script>
  // Close dropdowns on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      const active = document.activeElement as HTMLElement;
      if (active?.closest('.dropdown')) {
        active.blur();
      }
    }
  });
</script>
