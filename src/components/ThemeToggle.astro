---
// Theme toggle component using DaisyUI swap
import { Icon } from 'astro-icon/components';
---

<label class="swap swap-rotate btn btn-ghost btn-circle">
  <input type="checkbox" id="theme-toggle" class="theme-controller" value="dracula" />

  <!-- Sun icon (shown in dark mode, click to switch to light) -->
  <Icon name="tabler:sun" class="swap-on h-6 w-6" />

  <!-- Moon icon (shown in light mode, click to switch to dark) -->
  <Icon name="tabler:moon" class="swap-off h-6 w-6" />
</label>

<script>
  function initThemeToggle() {
    const toggle = document.getElementById('theme-toggle') as HTMLInputElement;
    if (!toggle) return;

    // Set initial state based on current theme
    const currentTheme = document.documentElement.getAttribute('data-theme');
    toggle.checked = currentTheme === 'dracula';

    // Handle toggle change
    toggle.addEventListener('change', (e) => {
      const target = e.target as HTMLInputElement;
      const theme = target.checked ? 'dracula' : 'light';
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    });
  }

  // Run on initial load
  initThemeToggle();

  // Re-run on Astro page transitions (View Transitions API)
  document.addEventListener('astro:after-swap', initThemeToggle);
</script>
